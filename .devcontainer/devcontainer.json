{
  "name": "Java Spring Boot Server",
  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/workspaces/demo-playground",
  
  "forwardPorts": [8083],

  "features": {
    "ghcr.io/devcontainers/features/github-cli": {}
  },

  "portsAttributes": {
    "8083": {
      "label": "Spring Boot App",
      "onAutoForward": "notify"
    }
  },

  "postCreateCommand": {
    "build-project": "cd app && mvn clean install -DskipTests"
  },
  
  "postAttachCommand": {
    "start-and-poll": "cd app && (mvn spring-boot:run &) && echo 'Server starting in background...' && while ! ss -tln | grep -q ':8083'; do echo 'Waiting for port 8083 to be ready...'; sleep 2; done && echo 'Port 8083 is ready! Setting to public.' && gh codespace ports visibility 8083:public -c \"$CODESPACE_NAME\" && echo 'Fetching public URL...' && PUBLIC_URL=$(gh codespace ports --json publicUrl -q '.[] | select(.portNumber==8083) | .publicUrl') && while ! curl -s -o /dev/null -I -w \"%{http_code}\" \"$PUBLIC_URL\" | grep -q \"[234]..\"; do echo \"Waiting for public URL ($PUBLIC_URL) to become live...\"; sleep 2; done && echo 'Public URL is live! Opening in browser...' && gh browse -p 8083"
  },

  "customizations": {
    "vscode": {
      "extensions": [],
      "settings": {}
    },
    "codespaces": {
      "openFiles": [
        "README.md"
      ]
    }
  },
  
  "remoteUser": "vscode"
}
